<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen</title>

    <script>
                //Variables para almacenar contraseña y reloj
                var contraseñaNueva = "muydificil";
                var reloj;
                function asignarValor() {//Funcion para asignarle el valor al span con el id puesto como cronometro
                    var numero = parseInt(document.getElementById("numero").value);
                    
                    document.getElementById("cronometro").innerHTML = 30;
                    
                }
                function inicio() {//Funcion para validar que ha escrito un numero el usuario entre 1 y 100
                    var numero = parseInt(document.getElementById("numero").value);
                    if (numero < 1 || numero > 100) {
                        document.getElementById("alertas").innerHTML = "El numero tiene que estar entre 1 y 100 ambos incluidos";
                        document.getElementById("numero").focus();
                    }
                    else {//En caso de que que este el numero que ha puesto el usuario entre 1 y 100 se meterá por el else
                        for (var i = 0; i < 1; i++) {//Lo que hace el else es llamar cada cierto tiempo a la funcion procesar
                            reloj = setInterval(procesar, 1000);
                        }
                        document.getElementById("alertas").innerHTML = "";
                    }
                }
                function procesar() {//Esta función se encargará de restart el cronometro hasta llegar a 0
                    var nro = parseInt(document.getElementById('cronometro').innerHTML);
                    nro--;
                    document.getElementById('cronometro').innerHTML = nro;
                    if (nro == 0) {
                        presionBoton();
                    }
                }
                function presionBoton() {//Funcion para detener el cronometro
                    clearInterval(reloj);;
                    nuevoCambio();
                }

                function nuevoCambio(){
                    document.getElementById("formulario").setAttribute("hidden","hidden");
                    document.getElementById("resultado").innerHTML = "Tiempo para cambiar la contraseña expirado";
                    var botonSalir = document.createElement("button");
                    botonSalir.innerHTML = "salir";
                    botonSalir.setAttribute("onclick","salir()");
                    document.getElementById("resultado").appendChild(botonSalir);
                    botonSalir.setAttribute("id","botonSalir");
                }

        function comprobarDatos() {/*
            Funcion comprobar datos, cada vez que el usuario le de a Enviar formulario se comprobaran el usuario y la contraseña*/
            var usuario = document.getElementById("usuario").value;
            var clave = document.getElementById("clave").value;
            if (usuario == "admin" && clave == contraseñaNueva) {
                //Si todo va bien le mostramos el usuario eliminando el atributo hidden y eliminamos el boton de enviar
                document.getElementById("formulario").removeAttribute("hidden");
                document.getElementById("formularioOriginal").removeChild(document.getElementById("botonEnviar"));
                asignarValor();//Llamamos a estas 2 funciones
                inicio();
            }

        }

        function cambiarContraseña(){//Funcion cambiar contraseña, cada vez que le de al boton de cambiar contraseña se guardará la nueva en la variable especificada
            contraseñaNueva = document.getElementById("nuevaContraseña").value;
        }

        function salir(){//Funcion salir cada vez que el usuario le de al boton salir
            /*
                Aquí se eliminará el boton de salir, se limpiará el resultado y la contraseña una vez que llegue a 0 el contador,
                luego se crearán un elemento input con sus atributos correspondientes(esto es para crear otra vez el boton de enviar ya
                que si no se elimina pues le puedes dar todo el rato y se generarían fallos de seguridad), y lo añadimos al conatenedor,
                y por último limpiamos todos los campos para dejarlo como estaba
            */
            document.getElementById("resultado").removeChild(document.getElementById("botonSalir"));
            document.getElementById("resultado").innerHTML = "";
            document.getElementById("nuevaContraseña").value = "";
            var botonEnviar = document.createElement("input");
            botonEnviar.setAttribute("type","submit");
            botonEnviar.setAttribute("name","enviar");
            botonEnviar.setAttribute("onclick","comprobarDatos()");
            botonEnviar.setAttribute("id","botonEnviar");
            botonEnviar.setAttribute("value","Enviar formulario");
            document.getElementById("formularioOriginal").appendChild(botonEnviar);
            document.getElementById("clave").value = "";
            document.getElementById("usuario").value = "";
            document.getElementById("nombre").value = "";
            document.getElementById("apellidos").value = "";
            document.getElementById("codigoVerificacion").value = "";
        }

        function validarNombre(){//Funcion para validar que el usuario me ha escrito el nombre correctamente
            var expresion = /[0-9]/;//Esta es la expresion, quiere decir que si contiene aunque sea un numero el campo de nombre
            var nombre = document.getElementById("nombre").value;//Obtenemos el nombre

            if (expresion.test(nombre) == true) {//Esto es que si se cumple la expresion, significa que el usuario ha puesto numeros
                document.getElementById("nombre").focus();//Por lo tanto, le hacemos el focus para que lo escriba bien
                document.getElementById("errores").innerHTML = "Error, el nombre solo puede tener letras, no números";//Le mostramos el error que tiene
            }
            else{//En caso contrario se eliminará el foco y se limpiará el mensaje de error
                document.getElementById("nombre").blur();
                document.getElementById("errores").innerHTML = "";
            }
        }
        //Para el resto de funciones de validar es lo mismo solo que cambiando la expresión regular, por eso solo explicaré que hace cada expresión regular
        function validarApellidos(){
            var expresion = /[0-9]/;//Esta es la expresion, quiere decir que si contiene aunque sea un numero el campo de apellidos
            var apellidos = document.getElementById("apellidos").value;

            if (expresion.test(apellidos) == true) {
                document.getElementById("apellidos").focus();
                document.getElementById("errores").innerHTML = "Error, el apellido solo puede tener letras, no números";
            }
            else{
                document.getElementById("apellidos").blur();
                document.getElementById("errores").innerHTML = "";
            }
        }

        function validarCodigo(){
            var expresion = /[A-Za-z]/;//Esta es la expresion, quiere decir que si contiene aunque sea un letra el campo de codigo, ya que solo puede contener numeros
            var codigoVerificacion = document.getElementById("codigoVerificacion").value;

            if (expresion.test(codigoVerificacion) == true) {
                document.getElementById("codigoVerificacion").focus();
                document.getElementById("errores").innerHTML = "Error, el codigo solo puede tener numeros, no letras";
            }
            else{
                document.getElementById("codigoVerificacion").blur();
                document.getElementById("errores").innerHTML = "";
            }
        }

        function validarUsuario(){
            var expresion = /[0-9]/;//Esta es la expresion, quiere decir que si contiene aunque sea un numero el campo de usuario
            var usuario = document.getElementById("usuario").value;

            if (expresion.test(usuario) == true) {
                document.getElementById("usuario").focus();
                document.getElementById("errores").innerHTML = "Error, el usuario solo puede tener letras, no números";
            }
            else{
                document.getElementById("usuario").blur();
                document.getElementById("errores").innerHTML = "";
            }
        }

    </script>
    <style> /*Este es el CSS para darle formato al boton, es decir, para que se vea más bonito */
        #cronometro {
            font-size: 50px;
            color: #0a0;
        }
    </style>
</head>

<body>
    <form onsubmit="return false" id="formularioOriginal">
        <span>Nombre:</span> <input type="text" name="nombre" id="nombre" onblur="validarNombre()"><br>
        <span>Apellidos:</span> <input type="text" name="Apellidos" id="apellidos" onblur="validarApellidos()"><br>
        <span>código de verificación:</span> <input type="text" name="codigoVerificacion"
            id="codigoVerificacion" onblur="validarCodigo()"><br><br>

        <span>Usuario admministrador:</span> <input type="text" name="usuario" id="usuario" onblur="validarUsuario()"><br>
        <span>Clave de acceso:</span> <input type="password" name="clave" id="clave"><br><br>
        <input type="submit" name="enviar" onclick="comprobarDatos()" id="botonEnviar" value="Enviar formulario"><br>
        <div id="resultado">

        </div><br><br>
        <div id="errores">

        </div>
    </form><br>

    <form name="formularios" id="formulario" hidden onsubmit="return false">
        <input type="text" name="numero" id="numero" hidden>
        <span id="cronometro">0</span>
        <br>
        <input type="button" id="enviar" value="Iniciar cuenta atras" hidden><br><br>
        <span>Nueva contraseña:</span> <input type="password" name="nuevaContraseña" id="nuevaContraseña">
        <input type="submit" name="enviar1" value="Cambiar contraseña" onclick="cambiarContraseña()">
    </form>

</body>

</html>